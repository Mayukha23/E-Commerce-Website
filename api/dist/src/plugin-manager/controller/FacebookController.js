'use strict';const a1001_0x566474=a1001_0x2a27;function a1001_0x2a27(_0x55f35f,_0x11be96){const _0x377abd=a1001_0x377a();return a1001_0x2a27=function(_0x2a2786,_0x3cbc14){_0x2a2786=_0x2a2786-0x1b8;let _0x3cdd98=_0x377abd[_0x2a2786];return _0x3cdd98;},a1001_0x2a27(_0x55f35f,_0x11be96);}(function(_0x206460,_0x35d5aa){const _0x43b7c5=a1001_0x2a27,_0x2a2c86=_0x206460();while(!![]){try{const _0x505266=-parseInt(_0x43b7c5(0x1f6))/0x1*(-parseInt(_0x43b7c5(0x1dc))/0x2)+-parseInt(_0x43b7c5(0x1f7))/0x3+-parseInt(_0x43b7c5(0x219))/0x4+parseInt(_0x43b7c5(0x1bf))/0x5*(-parseInt(_0x43b7c5(0x1e0))/0x6)+parseInt(_0x43b7c5(0x1de))/0x7+parseInt(_0x43b7c5(0x201))/0x8+parseInt(_0x43b7c5(0x1bb))/0x9*(parseInt(_0x43b7c5(0x1dd))/0xa);if(_0x505266===_0x35d5aa)break;else _0x2a2c86['push'](_0x2a2c86['shift']());}catch(_0x247c97){_0x2a2c86['push'](_0x2a2c86['shift']());}}}(a1001_0x377a,0x73da7));function a1001_0x377a(){const _0x4b90e8=['AccessToken','emailContent','AppId','content','6777207PNxxOb','password','../../api/core/models/EmailTemplate','isTest','5lNPFnQ','updateSettings','headers','isActive','replace','firstName','clientId','FacebookController','encrypt','pluginAdditionalInfo','../models/Plugin','toString','index','randomatic','../../api/core/models/Setting','typeorm','__esModule','pages/facebook/form','sendMail','findOne','flash','facebook\x20settings\x20updated\x20successfully','__importDefault','LoginLog','Unable\x20to\x20update\x20the\x20facebook\x20settings','../../api/core/models/AccessTokenModel','You\x20not\x20install\x20this\x20plugin.\x20or\x20problem\x20in\x20installation','hashPassword','facebook','64732KkLxkG','10zGlbUt','1231398ebHmnM','defineProperty','1600698sbJLnW','send','clientSecret','x-forwarded-for','email','storeRedirectUrl','cryptoSecret','emailId','../../api/core/models/Customer','connection','getRepository','getManager','../facebook/form','logo','username','AppSecretKey','token','__awaiter','tslib','oauthData','assert','validationErrors','4OzDLWh','280287athxSC','jsonwebtoken','MAILService','split','jwtSecret','render','socket','Settings','customerId','crypto-js','616616uYkMXH','lastLogin','remoteAddress','ipAddress','login','Plugins','Client\x20Secret\x20cannot\x20be\x20blank','../../env','Customer','AES','Loggedin\x20successfully.','createdDate','userId','Client\x20Id\x20cannot\x20be\x20blank','default','env','parse','{xxxxxx}','save','redirectUrl','productDetailData','body','notEmpty','redirect','1202924lQDfAA','home','status','errors'];a1001_0x377a=function(){return _0x4b90e8;};return a1001_0x377a();}Object[a1001_0x566474(0x1df)](exports,a1001_0x566474(0x1cf),{'value':!![]}),exports[a1001_0x566474(0x1c6)]=void 0x0;const tslib_1=require(a1001_0x566474(0x1f2));require('reflect-metadata');const typeorm_1=require(a1001_0x566474(0x1ce)),Plugin_1=require(a1001_0x566474(0x1c9)),Customer_1=require(a1001_0x566474(0x1e8)),LoginLog_1=require('../../api/core/models/LoginLog'),jsonwebtoken_1=tslib_1[a1001_0x566474(0x1d5)](require(a1001_0x566474(0x1f8))),mail_services_1=require('../../auth/mail.services'),EmailTemplate_1=require(a1001_0x566474(0x1bd)),env_1=require(a1001_0x566474(0x208)),Setting_1=require(a1001_0x566474(0x1cd)),AccessTokenModel_1=require(a1001_0x566474(0x1d8));class FacebookController{constructor(){}[a1001_0x566474(0x1cb)](_0x34f6e3,_0x3635ca){const _0x3c41c3=a1001_0x566474;return tslib_1[_0x3c41c3(0x1f1)](this,void 0x0,void 0x0,function*(){const _0x1c7b5e=_0x3c41c3,_0x4526fb=(0x0,typeorm_1[_0x1c7b5e(0x1eb)])()[_0x1c7b5e(0x1ea)](Plugin_1[_0x1c7b5e(0x206)]),_0x5e8ead=yield _0x4526fb['findOne']({'where':{'pluginName':_0x1c7b5e(0x1db)}});if(!_0x5e8ead)return _0x34f6e3[_0x1c7b5e(0x1d3)](_0x1c7b5e(0x21c),[_0x1c7b5e(0x1d9)]),_0x3635ca['redirect'](_0x1c7b5e(0x21a));const _0x5cb701=_0x5e8ead['pluginAdditionalInfo']?JSON[_0x1c7b5e(0x211)](_0x5e8ead[_0x1c7b5e(0x1c8)]):{};_0x3635ca[_0x1c7b5e(0x1fc)](_0x1c7b5e(0x1d0),{'title':_0x1c7b5e(0x1db),'path':_0x1c7b5e(0x1ec),'clientId':_0x5cb701[_0x1c7b5e(0x1b9)]?_0x5cb701[_0x1c7b5e(0x1b9)]:'','clientSecret':_0x5cb701[_0x1c7b5e(0x1ef)]?_0x5cb701[_0x1c7b5e(0x1ef)]:'','isTest':_0x5cb701[_0x1c7b5e(0x1be)]});});}[a1001_0x566474(0x1c0)](_0x29313d,_0x2c4c43){const _0x522be6=a1001_0x566474;return tslib_1[_0x522be6(0x1f1)](this,void 0x0,void 0x0,function*(){const _0x4af95d=_0x522be6;_0x29313d[_0x4af95d(0x1f4)]('clientId',_0x4af95d(0x20e))[_0x4af95d(0x217)](),_0x29313d['assert'](_0x4af95d(0x1e2),_0x4af95d(0x207))[_0x4af95d(0x217)]();const _0x41a0d2=_0x29313d[_0x4af95d(0x1f5)]();if(_0x41a0d2)return _0x29313d[_0x4af95d(0x1d3)](_0x4af95d(0x21c),_0x41a0d2),_0x2c4c43[_0x4af95d(0x218)](_0x4af95d(0x1db));const _0x3c112e=(0x0,typeorm_1[_0x4af95d(0x1eb)])()[_0x4af95d(0x1ea)](Plugin_1[_0x4af95d(0x206)]),_0xe88d29=yield _0x3c112e[_0x4af95d(0x1d2)]({'where':{'pluginName':_0x4af95d(0x1db)}});if(!_0xe88d29)return _0x29313d[_0x4af95d(0x1d3)](_0x4af95d(0x21c),[_0x4af95d(0x1d9)]),_0x2c4c43[_0x4af95d(0x218)]('home');const _0x2ead74=_0xe88d29[_0x4af95d(0x1c8)]?JSON['parse'](_0xe88d29[_0x4af95d(0x1c8)]):{};_0x2ead74[_0x4af95d(0x1b9)]=_0x29313d[_0x4af95d(0x216)][_0x4af95d(0x1c5)],_0x2ead74[_0x4af95d(0x1ef)]=_0x29313d[_0x4af95d(0x216)][_0x4af95d(0x1e2)],_0x2ead74[_0x4af95d(0x1be)]=_0x29313d['body'][_0x4af95d(0x1be)],_0xe88d29[_0x4af95d(0x1c8)]=JSON['stringify'](_0x2ead74);const _0x227126=yield _0x3c112e[_0x4af95d(0x213)](_0xe88d29);if(_0x227126)return _0x29313d[_0x4af95d(0x1d3)]('success',[_0x4af95d(0x1d4)]),_0x2c4c43['redirect'](_0x4af95d(0x21a));return _0x29313d[_0x4af95d(0x1d3)](_0x4af95d(0x21c),[_0x4af95d(0x1d7)]),_0x2c4c43[_0x4af95d(0x218)](_0x4af95d(0x21a));});}[a1001_0x566474(0x205)](_0x5909b7,_0x169583){const _0x16d8f8=a1001_0x566474;return tslib_1[_0x16d8f8(0x1f1)](this,void 0x0,void 0x0,function*(){const _0x7acae3=_0x16d8f8,_0x203f1e=(0x0,typeorm_1['getManager'])()[_0x7acae3(0x1ea)](Customer_1[_0x7acae3(0x209)]),_0x58c020=(0x0,typeorm_1[_0x7acae3(0x1eb)])()['getRepository'](EmailTemplate_1['EmailTemplate']),_0x2c5ffd=(0x0,typeorm_1[_0x7acae3(0x1eb)])()[_0x7acae3(0x1ea)](LoginLog_1[_0x7acae3(0x1d6)]),_0x4af176=(0x0,typeorm_1[_0x7acae3(0x1eb)])()[_0x7acae3(0x1ea)](Setting_1[_0x7acae3(0x1fe)]),_0x58834a=yield _0x203f1e[_0x7acae3(0x1d2)]({'where':{'email':_0x5909b7[_0x7acae3(0x216)]['emailId'],'deleteFlag':0x0}});if(!_0x58834a){const _0x26ede2=new Customer_1[(_0x7acae3(0x209))](),_0x4d0354=require(_0x7acae3(0x1cc)),_0x336dae=_0x4d0354('0',0x5)['toString']();_0x26ede2[_0x7acae3(0x1bc)]=yield Customer_1[_0x7acae3(0x209)][_0x7acae3(0x1da)](_0x336dae),_0x26ede2[_0x7acae3(0x1e4)]=_0x5909b7[_0x7acae3(0x216)][_0x7acae3(0x1e7)],_0x26ede2['username']=_0x5909b7[_0x7acae3(0x216)]['emailId'],_0x26ede2[_0x7acae3(0x1f3)]=_0x5909b7[_0x7acae3(0x216)][_0x7acae3(0x1f3)],_0x26ede2[_0x7acae3(0x1c2)]=0x1,_0x26ede2['ip']=(_0x5909b7[_0x7acae3(0x1c1)][_0x7acae3(0x1e3)]||_0x5909b7[_0x7acae3(0x1e9)][_0x7acae3(0x203)]||_0x5909b7[_0x7acae3(0x1fd)][_0x7acae3(0x203)]||_0x5909b7[_0x7acae3(0x1e9)][_0x7acae3(0x1fd)]['remoteAddress'])[_0x7acae3(0x1fa)](',')[0x0];const _0x316536=yield _0x203f1e['save'](_0x26ede2),_0x365bb9=new LoginLog_1['LoginLog']();_0x365bb9[_0x7acae3(0x1ff)]=_0x316536['id'],_0x365bb9[_0x7acae3(0x1e7)]=_0x316536[_0x7acae3(0x1e4)],_0x365bb9[_0x7acae3(0x204)]=(_0x5909b7[_0x7acae3(0x1c1)][_0x7acae3(0x1e3)]||_0x5909b7[_0x7acae3(0x1e9)][_0x7acae3(0x203)]||_0x5909b7['socket'][_0x7acae3(0x203)]||_0x5909b7['connection'][_0x7acae3(0x1fd)][_0x7acae3(0x203)])[_0x7acae3(0x1fa)](',')[0x0];const _0x2f1ab6=yield _0x2c5ffd[_0x7acae3(0x213)](_0x365bb9),_0x325838=yield _0x203f1e[_0x7acae3(0x1d2)]({'where':{'email':_0x316536[_0x7acae3(0x1e4)],'deleteFlag':0x0}});_0x325838['lastLogin']=_0x2f1ab6['createdDate'],yield _0x203f1e[_0x7acae3(0x213)](_0x325838);const _0x383b47=jsonwebtoken_1[_0x7acae3(0x20f)]['sign']({'id':_0x316536['id']},env_1[_0x7acae3(0x210)][_0x7acae3(0x1fb)]),_0x3826da=(0x0,typeorm_1[_0x7acae3(0x1eb)])()[_0x7acae3(0x1ea)](AccessTokenModel_1['AccessToken']),_0xe95fe1=new AccessTokenModel_1[(_0x7acae3(0x21d))]();_0xe95fe1[_0x7acae3(0x20d)]=_0x316536['id'],_0xe95fe1[_0x7acae3(0x1f0)]=_0x383b47,yield _0x3826da[_0x7acae3(0x213)](_0xe95fe1);const _0x7dd388=require(_0x7acae3(0x200)),_0x48d3f5=_0x7dd388[_0x7acae3(0x20a)][_0x7acae3(0x1c7)](_0x383b47,env_1[_0x7acae3(0x210)][_0x7acae3(0x1e6)])[_0x7acae3(0x1ca)](),_0x4011af=yield _0x58c020['findOne']({'where':{'emailTemplateId':0x9}}),_0x12330f=_0x4011af[_0x7acae3(0x1ba)][_0x7acae3(0x1c3)]('{name}',_0x316536[_0x7acae3(0x1ee)])[_0x7acae3(0x1c3)](_0x7acae3(0x212),_0x336dae),_0x3b7129=env_1[_0x7acae3(0x210)][_0x7acae3(0x1e5)],_0x5caa58=yield _0x4af176['findOne'](),_0x42a653={};_0x42a653[_0x7acae3(0x1ed)]=_0x5caa58,_0x42a653[_0x7acae3(0x1b8)]=_0x12330f,_0x42a653[_0x7acae3(0x214)]=_0x3b7129,_0x42a653[_0x7acae3(0x215)]=undefined,mail_services_1[_0x7acae3(0x1f9)][_0x7acae3(0x1d1)](_0x42a653,_0x316536[_0x7acae3(0x1e4)],_0x4011af['subject'],![],![],'');if(_0x316536){const _0x18f71a={'status':0x1,'message':'Loggedin\x20successfully.\x20','data':{'token':_0x48d3f5,'user':_0x316536}};return _0x169583[_0x7acae3(0x21b)](0xc8)[_0x7acae3(0x1e1)](_0x18f71a);}}else{const _0x30e393=jsonwebtoken_1[_0x7acae3(0x20f)]['sign']({'id':_0x58834a['id']},env_1[_0x7acae3(0x210)][_0x7acae3(0x1fb)]),_0x1928e1=require('crypto-js'),_0x334888=_0x1928e1[_0x7acae3(0x20a)][_0x7acae3(0x1c7)](_0x30e393,env_1[_0x7acae3(0x210)][_0x7acae3(0x1e6)])[_0x7acae3(0x1ca)](),_0x3dc7e2=new LoginLog_1['LoginLog']();_0x3dc7e2[_0x7acae3(0x1ff)]=_0x58834a['id'],_0x3dc7e2[_0x7acae3(0x1e7)]=_0x58834a[_0x7acae3(0x1e4)],_0x3dc7e2[_0x7acae3(0x1c4)]=_0x58834a[_0x7acae3(0x1c4)],_0x3dc7e2['ipAddress']=(_0x5909b7[_0x7acae3(0x1c1)][_0x7acae3(0x1e3)]||_0x5909b7[_0x7acae3(0x1e9)][_0x7acae3(0x203)]||_0x5909b7[_0x7acae3(0x1fd)][_0x7acae3(0x203)]||_0x5909b7[_0x7acae3(0x1e9)]['socket']['remoteAddress'])['split'](',')[0x0];const _0x58dcf1=yield _0x2c5ffd[_0x7acae3(0x213)](_0x3dc7e2),_0x33c041=yield _0x203f1e[_0x7acae3(0x1d2)]({'where':{'email':_0x58834a[_0x7acae3(0x1e4)],'deleteFlag':0x0}});_0x33c041[_0x7acae3(0x202)]=_0x58dcf1[_0x7acae3(0x20c)],yield _0x203f1e[_0x7acae3(0x213)](_0x33c041);const _0x10d892=(0x0,typeorm_1['getManager'])()['getRepository'](AccessTokenModel_1['AccessToken']),_0xe0c160=new AccessTokenModel_1[(_0x7acae3(0x21d))]();_0xe0c160[_0x7acae3(0x20d)]=_0x58834a['id'],_0xe0c160[_0x7acae3(0x1f0)]=_0x30e393,yield _0x10d892[_0x7acae3(0x213)](_0xe0c160);const _0x357913={'status':0x1,'message':_0x7acae3(0x20b),'data':{'token':_0x334888,'user':_0x58834a}};return _0x169583['status'](0xc8)[_0x7acae3(0x1e1)](_0x357913);}});}}exports[a1001_0x566474(0x1c6)]=FacebookController;